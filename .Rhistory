options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina=3,
echo = TRUE,
eval = TRUE,
message = FALSE,
warning = FALSE)
packages = c('tidytext', 'tidyverse', 'dplyr', 'ggraph',
'widyr', 'wordcloud', 'ggwordcloud', 'DT',
'textplot', 'lubridate', 'hms', 'tidygraph',
'igraph')
for(p in packages){
if(!require(p, character.only = T)){
install.packages(p)
}
library(p, character.only = T)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/news20.rds") #output a consolidated data set of raw text in .rds format
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
glimpse(raw_text)
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/news20.rds") #output a consolidated data set of raw text in .rds format
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/news20.rds") #output a consolidated data set of raw text in .rds format
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
news20 <- "data/20news/"
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
packages = c('tidytext', 'tidyverse', 'dplyr', 'ggraph',
'widyr', 'wordcloud', 'ggwordcloud', 'DT',
'textplot', 'lubridate', 'hms', 'tidygraph',
'igraph')
for(p in packages){
if(!require(p, character.only = T)){
install.packages(p)
}
library(p, character.only = T)
}
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/news20.rds") #output a consolidated data set of raw text in .rds format
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
distill::create_post("Assignment")
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina=3,
echo = TRUE,
eval = TRUE,
message = FALSE,
warning = FALSE)
read_rds(news20.rds)
packages = c('tidytext', 'tidyverse', 'dplyr', 'ggraph',
'widyr', 'wordcloud', 'ggwordcloud', 'DT',
'textplot', 'lubridate', 'hms', 'tidygraph',
'igraph')
for(p in packages){
if(!require(p, character.only = T)){
install.packages(p)
}
library(p, character.only = T)
}
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
read_rds(raw_data.rds)
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
news20 <- "data/20news/"
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_data,"data/rds/raw_data.rds") #output a consolidated data set of raw text in .rds format
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/raw_data.rds") #output a consolidated data set of raw text in .rds format
read_rds(raw_data.rds)
read_rds(raw_text)
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/raw_data.rds") #output a consolidated data set of raw text in .rds format
read_rds(raw_text.rds)
read_rds(raw_text)
read_rds(raw_text)
raw_data <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_data,"data/rds/raw_data.rds") #output a consolidated data set of raw text in .rds format
read_rds(raw_data)
read_rds(raw_data)
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/news20.rds") #output a consolidated data set of raw text in .rds format
raw_text
glimpse(raw_text)
read_rds(news20)
read_rds(news20.rds)
read_rds(news20.rds)
read_rds()
read_rds(news20)
distill::create_post("Text visualisation with R")
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina=3,
echo = TRUE,
eval = TRUE,
message = FALSE,
warning = FALSE)
packages = c('tidytext', 'tidyverse', 'dplyr', 'ggraph',
'widyr', 'wordcloud', 'ggwordcloud', 'DT',
'textplot', 'lubridate', 'hms', 'tidygraph',
'igraph')
for(p in packages){
if(!require(p, character.only = T)){
install.packages(p)
}
library(p, character.only = T)
}
news20 <- "data/20news/"
read_folder <- function(infolder) { #writing a function
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder = dir(news20, full.names = TRUE)) %>%
mutate(folder_out = map(folder, read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder), id, text)
write_rds(raw_text,"data/rds/news20.rds") #output a consolidated data set of raw text in .rds format
raw_text <- read_rds("data/rds/news20.rds")
glimpse(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>% #count the unique article ID
ggplot(aes(messages, newsgroup)) +
#x-axis is no of articles, y-axis is the different news outlets
geom_col(fill = "lightblue") +
labs(y = NULL)
cleaned_text <- raw_text %>%
group_by(newsgroup, id) %>%
filter(cumsum(text == "") > 0,
cumsum(str_detect(text, "^--")) == 0) %>%
#to detect string based on your defined pattern
ungroup()
cleaned_text <- cleaned_text %>%
filter(str_detect(text, "^[^>]+[A-Za-z\\d]")
| text == "",
!str_detect(text, "writes(:|\\.\\.\\.)$"),
!str_detect(text, "^In article <")
)
glimpse(cleaned_text)
usenet_words <- cleaned_text %>%
unnest_tokens(word, text) %>%
filter(str_detect(word, "[a-z']$"),
!word %in% stop_words$word)
glimpse(usenet_words)
usenet_words %>%
count(word, sort = TRUE)
words_by_newsgroup <- usenet_words %>%
count(newsgroup, word, sort = TRUE) %>% #count generates n column and sort in descending order
ungroup()
glimpse(words_by_newsgroup)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300)
set.seed(1234)
words_by_newsgroup %>%
filter(n > 0) %>%
ggplot(aes(label = word, size = n)) +
geom_text_wordcloud() +
theme_minimal() +
facet_wrap(~newsgroup)
tf_idf <- words_by_newsgroup %>%
bind_tf_idf(word, newsgroup, n) %>%
arrange(desc(tf-idf))
DT::datatable(tf_idf, filter = 'top') %>% #to insert filter box at the top
formatRound(columns = c('tf', 'idf', 'tf_idf'),
digits = 3) %>% #round up to 3 dp
formatStyle(0, target = 'row', lineHeight='25%') #reduce until 25%
tf_idf %>%
filter(str_detect(newsgroup, "^sci\\.")) %>% #to look for all newsgroups with 'sci'
group_by(newsgroup) %>%
slice_max(tf_idf, n = 12) %>%
ungroup() %>%
mutate(word = reorder(word, tf_idf)) %>%
ggplot(aes(tf_idf, word, fill = newsgroup)) +
geom_col(show.legend = FALSE) +
facet_wrap(~ newsgroup, scales = "free") + #x-axis scale of each graph not standardised
labs(x = "tf-idf", y = NULL) #all
newsgroup_cors <- words_by_newsgroup %>%
pairwise_cor(newsgroup, word, n, sort = TRUE)
glimpse(newsgroup_cors)
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>% #only focus on pairs with correlation >0.025
graph_from_data_frame() %>% #in a graph data model
ggraph(layout = "fr") +
geom_edge_link(aes(alpha = correlation, #intensity
width = correlation)) + #edge weight
geom_node_point(size = 6, color = "lightblue") +
geom_node_text(aes(label = name), color = "red", repel = TRUE) +
theme_void()
bigrams <- cleaned_text %>%
unnest_tokens(bigram, #output called 'bigram'
text, #search through text column
token = "ngrams",
n = 2) #bigram is n=2
glimpse(bigrams)
bigrams_separated <- bigrams %>%
filter(bigram != 'NA') %>% #excludes bigrams w NA
separate(bigram, c("word1", "word2"), sep = " ")
bigrams_filtered <- bigrams_separated %>%
filter(!word1 %in% stop_words$word) %>%
filter(!word2 %in% stop_words$word)
glimpse(bigrams_filtered)
bigram_counts <- bigrams_filtered %>%
count(word1, word2, sort = TRUE)
bigram_counts <- bigrams_filtered %>%
count(word1, word2, sort = TRUE)
bigram_graph <- bigram_counts %>%
filter(n>3) %>%
graph_from_data_frame()
bigram_graph
set.seed(1234)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name),
vjust = 1,
hjust = 1)
set.seed(1234)
#use grid package to build arrow
a <- grid::arrow(type = "closed",
length = unit(.15, "inches"))
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n),
show.legend = FALSE,
arrow = a,
end_cap = circle(.05, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name),
vjust = 1,
hjust = 1) +
theme_void()
